---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.17.2
  name: zarfpackages.ops.d0s.dev
spec:
  group: ops.d0s.dev
  names:
    categories:
    - zarf
    kind: ZarfPackage
    listKind: ZarfPackageList
    plural: zarfpackages
    shortNames:
    - zp
    singular: zarfpackage
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .spec.source
      name: Source
      type: string
    - jsonPath: .status.phase
      name: Phase
      type: string
    - jsonPath: .status.deployedVersion
      name: Version
      type: string
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: ZarfPackage is the Schema for the zarfpackages API.
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: ZarfPackageSpec defines the desired state of ZarfPackage.
            properties:
              adoptExistingResources:
                description: AdoptExistingResources indicates whether to adopt any
                  pre-existing K8s resources into the Helm charts managed by Zarf.
                type: boolean
              architecture:
                description: Architecture is the target architecture for the Zarf
                  package.
                type: string
              components:
                description: Components is a list of components to deploy. Adding
                  this field will skip the prompts for selected components.
                items:
                  type: string
                type: array
              features:
                description: Features is a list of features to enable in the Zarf
                  package.
                items:
                  type: string
                type: array
              insecureSkipTLSVerify:
                description: InsecureSkipTLSVerify indicates whether to skip TLS verification
                  for the Zarf package.
                type: boolean
              key:
                description: Key is the key used for authentication with the Zarf
                  package.
                type: string
              logFormat:
                description: LogFormat is the format of the logs for the Zarf package.
                type: string
              logLevel:
                description: LogLevel is the level of logging for the Zarf package.
                type: string
              namespace:
                description: Namespace is the Kubernetes namespace to deploy the Zarf
                  package into.
                type: string
              noColor:
                description: NoColor indicates whether to disable colored output in
                  logs.
                type: boolean
              ociConcurrency:
                description: OciConcurrency is the number of concurrent OCI operations
                  for the Zarf package.
                type: integer
              plainHTTP:
                description: PlainHTTP indicates whether to use plain HTTP instead
                  of HTTPS for the Zarf package.
                type: boolean
              retries:
                description: Retries is the number of times to retry deploying the
                  Zarf package in case of failure.
                type: integer
              set:
                description: Set is a list of key-value pairs as package variables.
                items:
                  type: string
                type: array
              shasum:
                description: Shasum is the SHA256 checksum of the Zarf package.
                type: string
              skipSignatureValidation:
                description: SkipSignatureValidation indicates whether to skip signature
                  validation for the Zarf package.
                type: boolean
              source:
                description: Source is the location of the Zarf package OCI
                type: string
              syncPolicy:
                allOf:
                - enum:
                  - Ignore
                  - Detect
                  - Remediate
                - enum:
                  - Ignore
                  - Detect
                  - Remediate
                default: Ignore
                description: |-
                  SyncPolicy defines how the operator handles drift between desired and actual state.
                  Ignore: Do not check for drift (default)
                  Detect: Check for drift and report in status, but do not remediate
                  Remediate: Check for drift and automatically redeploy to fix it
                type: string
              timeout:
                description: Timeout is the maximum duration to wait for the Zarf
                  package deployment.
                type: string
              tmpdir:
                description: Tmpdir is the temporary directory for the Zarf package.
                type: string
              zarfCache:
                description: ZarfCache is the cache directory for the Zarf package.
                type: string
            required:
            - source
            type: object
          status:
            description: ZarfPackageStatus defines the observed state of ZarfPackage.
            properties:
              componentStatuses:
                description: ComponentStatuses tracks the status of each deployed
                  component
                items:
                  description: ComponentStatus tracks the status of a single deployed
                    component
                  properties:
                    installCharts:
                      description: InstalledCharts lists the Helm charts deployed
                        by this component
                      items:
                        description: InstalledChartStatus tracks a Helm chart installed
                          by a component
                        properties:
                          chartName:
                            description: ChartName is the name of the Helm release
                            type: string
                          namespace:
                            description: Namespace where the chart is installed
                            type: string
                          status:
                            description: Status of the chart (Succeeded, Failed)
                            type: string
                        required:
                        - chartName
                        - namespace
                        - status
                        type: object
                      type: array
                    name:
                      description: Name of the component
                      type: string
                    observedGeneration:
                      description: ObservedGeneration is the generation of the package
                        when this component was deployed
                      type: integer
                    status:
                      description: Status of the component (Succeeded, Failed, Deploying,
                        Removing)
                      type: string
                  required:
                  - name
                  - status
                  type: object
                type: array
              conditions:
                description: Conditions represent the latest observations
                items:
                  description: ZarfPackageCondition represents a condition of the
                    ZarfPackage
                  properties:
                    lastTransitionTime:
                      description: LastTransitionTime is when the condition last changed
                      format: date-time
                      type: string
                    message:
                      description: Message is a human-readable description
                      type: string
                    reason:
                      description: Reason is a machine-readable reason for the condition
                      type: string
                    status:
                      description: Status of the condition (True, False, Unknown)
                      type: string
                    type:
                      description: Type of condition
                      type: string
                  required:
                  - status
                  - type
                  type: object
                type: array
              deployedGeneration:
                description: DeployedGeneration is the Zarf deployment generation
                type: integer
              deployedSpecHash:
                description: |-
                  DeployedSpecHash is the hash of deployment-affecting spec fields
                  Used to detect when a redeployment is needed (follows Flux's lastAttemptedConfigDigest pattern)
                type: string
              deployedVersion:
                description: DeployedVersion is the version of the deployed package
                type: string
              driftInfo:
                description: DriftInfo contains details about detected drift (when
                  SyncPolicy is Detect or Remedeiate)
                properties:
                  detected:
                    description: Detected indicates whether drift was detected
                    type: boolean
                  lastCheckTime:
                    description: LastCheckTime is when drift was last checked
                    format: date-time
                    type: string
                  message:
                    description: Message provides human-readable drift details
                    type: string
                  missingReleases:
                    description: MissingReleases lists Helm releases that should exist
                      but don't
                    items:
                      type: string
                    type: array
                required:
                - detected
                type: object
              lastReconcileTime:
                description: LastReconcileTime is when the package was last reconciled
                format: date-time
                type: string
              observedGeneration:
                description: ObservedGeneration is the generation observed by the
                  controller
                format: int64
                type: integer
              packageName:
                description: PackageName is the name from the package metadata
                type: string
              phase:
                description: Phase is the current phase of the deployment
                enum:
                - Pending
                - Deploying
                - Deployed
                - Failed
                - Removing
                type: string
              source:
                description: Source is the resolved source of the package
                type: string
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
