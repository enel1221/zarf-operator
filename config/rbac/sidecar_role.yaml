apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: zarf-sidecar-role
rules:
# Node access for architecture detection
- apiGroups: [""]
  resources: [nodes]
  verbs: [get, list]

# Zarf state management (stored in secrets)
- apiGroups: [""]
  resources: [secrets]
  verbs: [get, list, watch, create, update, patch, delete]

# Namespace management for package deployments
- apiGroups: [""]
  resources: [namespaces]
  verbs: [get, list, watch, create, update, patch]

# Core resources for deployed packages
- apiGroups: [""]
  resources: [pods, services, configmaps, serviceaccounts, persistentvolumeclaims]
  verbs: ["*"]

# Apps resources for Helm charts
- apiGroups: [apps]
  resources: [deployments, daemonsets, statefulsets, replicasets]
  verbs: ["*"]

# Batch resources
- apiGroups: [batch]
  resources: [jobs, cronjobs]
  verbs: ["*"]

# RBAC for deployed charts
- apiGroups: [rbac.authorization.k8s.io]
  resources: [roles, rolebindings, clusterroles, clusterrolebindings]
  verbs: ["*"]

# Networking
- apiGroups: [networking.k8s.io]
  resources: [ingresses, networkpolicies]
  verbs: ["*"]

# CRDs that packages might create
- apiGroups: [apiextensions.k8s.io]
  resources: [customresourcedefinitions]
  verbs: ["*"]

# Catch-all for arbitrary CRs deployed by packages
- apiGroups: ["*"]
  resources: ["*"]
  verbs: ["*"]